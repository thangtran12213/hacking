<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #ip {
            width: 300px;
            height: 30px;
            line-height: 30px;
            border-radius: 10px;
            padding: 0px 10px;
            font-size: 16px;
            outline: none;
        }
        button {
            outline: 0;
            height: 35px;
            width: 100px;
            border: 5px;
            border-radius: 10px;
            background: orange;
            color: white;
            cursor: pointer;
            font-weight: 500;
        }
        #update-vote {
            width: 200px;
        }
    </style>
</head>
<body>
    <p>IP được thể hiện từ 0 đến 255. Ví dụ: 69.69.69.69</p>
    <input id="ip" type="text" placeholder="1.1.1.1">
    <button id="btn-submit">Tăng 1 view</button>
    <p id="notify"></p>
    <p id="vote">Số lượng vote hiện tại: </p>
    <button id="update-vote">Cập nhật số lượng vote</button>
    <script>
        window.addEventListener("load", () => {

            function LoadVote() {
                var myHeaders = new Headers();
                myHeaders.append("Accept", "application/json, text/plain, */*");
                myHeaders.append("Accept-Language", "en-US,en;q=0.9");
                myHeaders.append("Authorization", "");
                myHeaders.append("Cache-Control", "no-cache");
                myHeaders.append("Connection", "keep-alive");
                myHeaders.append("Origin", "http://lwldance.doanthanhnien.vn");
                myHeaders.append("Pragma", "no-cache");
                myHeaders.append("Referer", "http://lwldance.doanthanhnien.vn/");
                myHeaders.append("Sec-Fetch-Dest", "empty");
                myHeaders.append("Sec-Fetch-Mode", "cors");
                myHeaders.append("Sec-Fetch-Site", "cross-site");
                myHeaders.append("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36");
                myHeaders.append("sec-ch-ua", "\"Not_A Brand\";v=\"99\", \"Google Chrome\";v=\"109\", \"Chromium\";v=\"109\"");
                myHeaders.append("sec-ch-ua-mobile", "?0");
                myHeaders.append("sec-ch-ua-platform", "\"Windows\"");

                var requestOptions = {
                method: 'GET',
                headers: myHeaders,
                redirect: 'follow'
                };

                fetch("https://api.lofmalto.vn/flashmob-submissions/detail/24309f80-bdc0-4bbf-9957-d41098017a78", requestOptions)
                .then(response => response.json())
                .then( ({data}) => {
                    let vote = document.getElementById("vote")
                    console.log(data)
                    vote.innerText = "Số lượng vote hiện tại:" + data?.flashmobSubmission?.voteCount;
                })
                .catch(error => console.log('error', error));
            }
            LoadVote();

            let btn = document.getElementById("btn-submit");
            const notify = document.getElementById("notify");
            btn.addEventListener("click", () => {
                let IP = document.getElementById("ip");
                const regexExp = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/gi;
                if(!regexExp.test(IP.value)) {
                    document.getElementById("notify").innerText = "IP nhập vào không hợp lệ"
                    return;
                }
                
                console.log(IP.value);
                var myHeaders = new Headers();
                myHeaders.append("Accept", "application/json, text/plain, */*");
                myHeaders.append("Accept-Language", "en-US,en;q=0.9");
                myHeaders.append("Authorization", "");
                myHeaders.append("Cache-Control", "no-cache");
                myHeaders.append("Connection", "keep-alive");
                myHeaders.append("Content-Type", "application/json");
                myHeaders.append("Origin", "http://lwldance.doanthanhnien.vn");
                myHeaders.append("Pragma", "no-cache");
                myHeaders.append("Referer", "http://lwldance.doanthanhnien.vn/");
                myHeaders.append("Sec-Fetch-Dest", "empty");
                myHeaders.append("Sec-Fetch-Mode", "cors");
                myHeaders.append("Sec-Fetch-Site", "cross-site");
                myHeaders.append("User-Agent", "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36");
                myHeaders.append("sec-ch-ua", "\"Not_A Brand\";v=\"99\", \"Google Chrome\";v=\"109\", \"Chromium\";v=\"109\"");
                myHeaders.append("sec-ch-ua-mobile", "?0");
                myHeaders.append("sec-ch-ua-platform", "\"Windows\"");
                var raw = JSON.stringify({
                "publicIP": IP.value
                });
                var requestOptions = {
                method: 'PUT',
                headers: myHeaders,
                body: raw,
                redirect: 'follow'
                };
                const ID = "24309f80-bdc0-4bbf-9957-d41098017a78";
                fetch("https://api.lofmalto.vn/flashmob-submissions/vote-by-ip/" + ID, requestOptions)
                .then(response => response.text())
                .then(result => {
                    notify.innerText = " Thành công với IP " + IP.value + " . Nhập IP khác để tiếp tục";
                })
                .catch(error => {
                    notify.innerText = "Nhập IP Khác, IP: " + IP.value + " đã được sử dụng";
                    console.log('error', error)
                });
            })
        });
    </script>
</body>
</html>